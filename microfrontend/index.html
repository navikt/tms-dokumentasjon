<!DOCTYPE html>
<html lang="nb">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../img/favicon.ico">
        <title>Microfrontend - Min side utvikler-docs</title>
        <link href="../css/bootstrap.min.css" rel="stylesheet">
        <link href="../css/font-awesome.min.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css">
        <link href="../styles/styles.css" rel="stylesheet">
        <link href="../styles/container.css" rel="stylesheet">
        <link href="../styles/blocks.css" rel="stylesheet">
        <link href="../styles/pages.css" rel="stylesheet">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script>hljs.highlightAll();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="..">Min side utvikler-docs</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar-collapse">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="navitem">
                                <a href="../guide/" class="nav-link">Innholdsguide</a>
                            </li>
                            <li class="navitem">
                                <a href="../utkast/" class="nav-link">Utkast</a>
                            </li>
                            <li class="navitem active">
                                <a href="./" class="nav-link">Microfrontend</a>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Varsler <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../varsler/" class="dropdown-item">Oversikt</a>
</li>
                                    
<li>
    <a href="../varsler/produsere/" class="dropdown-item">Produsere varsler</a>
</li>
                                    
<li>
    <a href="../varsler/konsumere/" class="dropdown-item">Konsumere varsler</a>
</li>
                                    
<li>
    <a href="../varsler/migrere/" class="dropdown-item">Migrere fra AVRO</a>
</li>
                                </ul>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ml-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Søk
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">

<div class="col-md-3"><div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix custom-toc" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#toc-collapse" title="Innholdsfortegnelse">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-secondary">
        <ul class="nav flex-column">
            
    <li class="nav-item"><a href="#microfrontends-pa-min-side" class="nav-link">Microfrontends på min side</a>
        <ul class="nav flex-column">
    <li class="nav-item"><a href="#hvordan-kan-mitt-team-fa-en-microfrontend-pa-min-side" class="nav-link">Hvordan kan mitt team få en microfrontend på min side?</a>
        <ul class="nav flex-column">
        </ul>
    </li>
    <li class="nav-item"><a href="#enabledisable" class="nav-link">Enable/disable</a>
        <ul class="nav flex-column">
        </ul>
    </li>
    <li class="nav-item"><a href="#sprak" class="nav-link">Språk</a>
        <ul class="nav flex-column">
        </ul>
    </li>
    <li class="nav-item"><a href="#shared-dependencies" class="nav-link">Shared dependencies</a>
        <ul class="nav flex-column">
        </ul>
    </li>
        </ul>
    </li>
        </ul>
    </div>
</div>
    
    <div class="octocat">
        <a href="https://github.com/navikt/tms-mikrofrontend-selector/blob/main/howto.md">
            <img class="octocat-img" src="/img/github-mark.png"/>
        </a>
    </div>
    
</div>
<div class="col-md-9 tms-theme" role="main">

<h1 id="microfrontends-pa-min-side">Microfrontends på min side</h1>
<p>Microfrontendene brukt på min side kommer i form av små bokser med forskjellig funksjonalitet og innhold teamene ønsker å presentere til en spesifikk gruppe brukere. Vi stiller visse <a href="https://aksel.nav.no/god-praksis/artikler/retningslinjer-for-design-av-mikrofrontends">designkrav</a> til utformingen av microfrontendene, for å ivareta en god helhetlig brukeropplevelse. Det overordnede konseptet er at bruker skal finne igjen mye av sitt mest relevante innhold og av innganger gruppert og løftet på min side.</p>
<p>Vår microfrontendrigg består av tre deler. Mikrofrontenden som lastes opp til frontend-plattform sin CDN, min side som viser microfrontendene, og Kafka-backenden for å aktivere og deaktivere mikrofrontends for spesifikke brukere. Selve mikrofrontenden blir bygget til ESM, lastet opp til CDN og hentes deretter inn som en remote ES-Modul.</p>
<h2 id="hvordan-kan-mitt-team-fa-en-microfrontend-pa-min-side">Hvordan kan mitt team få en microfrontend på min side?</h2>
<p>Oppsett med bruk av template:</p>
<h3 id="1-klon-repo">1. Klon repo:</h3>
<p>Her finner du vårt template for <a href="https://github.com/navikt/tms-mikrofrontend-template-vitets">typescript</a>. Vi har laget en walktrough av hvordan en utfyller template under. Ønsker du å gjøre det på egen måte er [dette] listen med ting som må være på plass.</p>
<h3 id="2-sett-opp-oppdatering-av-url-til-den-gjeldene-javascript-koden">2. Sett opp oppdatering av url til den gjeldene javascript-koden</h3>
<p>Opplasting til CDN og uthenting av adressen hvor ES-modulen hentes fra gjøres gjennom vår workflow. For å få tilgang til å kjøre workflowen, kontakt Min side teamet på #minside-microfrontends og be oss om følgende:</p>
<ol>
<li>Be om å få installert min-side-repo-authenticator i repoet</li>
<li>Få utdelt PRIVATE_KEY og APP_ID som legges inn som action-secrets i repoet</li>
</ol>
<p>Når dette er lagt inn har repoet nå tilgang til å kjøre workflowen</p>
<ol>
<li>Legg inn oppdateringsworkflow i github workflows mappa til prosjektet</li>
</ol>
<pre><code class="language-yaml">name: Update microfrontend-manifest
on: &lt;ønsket hook&gt;

jobs:
  trigger_manifest_update:
    uses: navikt/tms-deploy/.github/workflows/oppdater-mikrofrontend-manifest.yaml@main
    with:
      cluster: &quot;&lt;cluster: dev-gcp eller prod-gcp&gt;&quot;
      id: &quot;&lt;microfrontend_id&gt;&quot;
      url: &quot;&lt;url til js-kode i cdn&gt;&quot;
    secrets: inherit
 ```

#### Hvordan vet jeg hva urlen til javascriptet er?
Om du bruker `navikt/frontend/actions/cdn-upload/v1@main`:

1. Hent path fra cdn-upload outputs(`${{ &lt;steps/jobs&gt;.&lt;id til cdn-upload step eller job&gt;.outputs.uploaded }}`)
2. Legg til host (`https://cdn.nav.no`)
```bash
files=&quot;${{ &lt;steps/jobs&gt;.&lt;id til cdn-upload step eller job&gt;.outputs.uploaded }}&quot;
cdn_path=$(echo $files|cut -d &quot;,&quot; -f &lt;index til js-url i liste&gt;)
cdn_url=&quot;https://cdn.nav.no/$cdn_path&quot;
</code></pre>
<p>Eksempel finnes i<br />
<a href="https://github.com/navikt/tms-mikrofrontend-selector/tree/main/.github/workflows/manifest-triggere">workflows-mappa til tms-mikrofrontend-selector</a><br />
NB: Urlen skal være til <strong>js-koden</strong>, ikke json-manifest.</p>
<h3 id="3-koble-til-lsningen">3. Koble til løsningen</h3>
<ol>
<li><microfrontendId> skal samsvare med navnet på frontendrepoet</li>
<li>Koble på <a href="https://github.com/navikt/min-side-microfrontend-topic-iac">min-side-microfrontend-topicet</a></li>
<li>Du kan nå sende oss Enable/Disable meldinger via Kafka for å skru av og på microfrontenden for spesifikke brukere</li>
</ol>
<h2 id="enabledisable">Enable/disable</h2>
<p>Om en microfrontend vises avhenger av om den er enablet for en gitt bruker. Dette setter du ved å sende en melding på<br />
  microfrontend-topicet.</p>
<h3 id="enable-melding-nar-en-bruker-skal-se-mikrofrontenden">Enable-melding når en bruker skal se mikrofrontenden</h3>
<pre><code class="language-json">{
    &quot;@action&quot;: &quot;enable&quot;,
    &quot;ident&quot;: &lt;ident for bruker: fnr/dnr&gt;,
    &quot;microfrontend_id&quot;: &lt;microfrontendId&gt;,
    &quot;sensitivitet&quot;: &lt;nivå som kreves for å se innholdet i mikrofrontenden, gyldige verdier: substantial og high&gt;,
    &quot;@initiated_by&quot;: &lt;ditt-team&gt;
}
</code></pre>
<h3 id="disable-melding-nar-bruker-ikke-skal-se-mikrofrontenden-lenger">Disable-melding når bruker ikke skal se mikrofrontenden lenger</h3>
<pre><code class="language-json">{
    &quot;@action&quot;:  &quot;disable&quot;,
    &quot;ident&quot;: &lt;ident for bruker: fnr/dnr&gt;,
    &quot;microfrontend_id&quot;: &lt;microfrontendId&gt;,
    &quot;@initiated_by&quot;:&lt;ditt-team&gt;
}
</code></pre>
<h3 id="meldingsbygger-bibliotek">Meldingsbygger-bibliotek</h3>
<p>Det er tilgjengelig på <a href="https://github.com/navikt/tms-mikrofrontend-selector/packages/1875650">github packages</a></p>
<h2 id="sprak">Språk</h2>
<p>Vi bruker språkvelgeren i Dekoratøren. For å vite hvilket språk man skal vise så sender vi et event via session storage.<br />
Man kan enkelt sette opp en provider som vi har<br />
gjort <a href="https://github.com/navikt/tms-utkast-mikrofrontend/blob/main/src/provider/LanguageProvider.tsx">her</a>.</p>
<h2 id="shared-dependencies">Shared dependencies</h2>
<p>For å unngå å ha for store bundles så deler vi noen dependencies på tvers av apper. Disse hentes ned en gang ved første<br />
page load fra en CDN og caches i browseren. Foreløpig ligger react, react-dom og ds-css i CDNen.</p>
<p>CSSen fra designsystemet hentes i skallet til Min side. Denne skal deles på tvers og ikke bundles med i mikrofrontenden.<br />
Vi bør ligge på samme major versjon, veilendende versjon<br />
ligger <a href="https://github.com/navikt/tms-min-side/blob/main/index.html">her</a>.</p>
<h3 id="hvordan-bruke-amplitude-i-mikrofrontenden">Hvordan bruke amplitude i mikrofrontenden?</h3>
<p>Amplitude fungerer som vanlig (se <a href="https://github.com/navikt/aap-min-side-microfrontend/blob/main/src/utils/amplitude.ts">AAP sin mikrofrontend</a>). Dere kan fritt logge de eventene dere vil, men for at vi skal kunne foreta målinger for Min side som helhet er det påkrevd at trykk på mikrofrontenden sender et navigere event med feltet <br />
<code>komponent: &lt;microfrontendId&gt;</code>.</p>
<p>Videre anbefaler vi å følge <a href="https://github.com/navikt/analytics-taxonomy">taksonominen</a> i NAV.</p>
<h3 id="hva-er-sensitivitet">Hva er sensitivitet?</h3>
<p>Feltet <code>sensitivitet</code> i enablemeldingen korresponderer direkte til<br />
de <a href="https://docs.digdir.no/docs/idporten/oidc/oidc_protocol_id_token#acr-values">nye acr-veridene</a> i IDporten token.</p>
<ul>
<li>Om informasjonen som vises krever <code>idporten-loa-high</code> innlogging skal <code>sensitivitet</code> settes til <code>high</code>. </li>
<li>Om informasjonen kan vises uavhengig av innloggingsnivå skal <code>sensitivitet</code> settes til <code>substantial</code>.</li>
</ul>
<p>Om sensitivitet ikke er spesifisert i kafka-meldingen settes det alltid til <code>high</code> hos oss.<br />
Om en person logger inn med <code>idporten-loa-substantial</code> og det finnes mikrofrontender som personen kan se<br />
på <code>idporten-loa-high</code> vil bruker få beskjed om dette og link til en "stepup"<br />
login. Se også <a href="https://docs.nais.io/security/auth/idporten/#security-levels">NAIS docs</a> for mer info om acr-verdiene</p>
<p><img alt="Katten Min som sitter på ett garnnøste" src="../katt/katt-n%C3%B8ste.svg" title="Nøstekatt" /></p></div>

            </div>
        </div>

        <footer class="col-md-12">
<div class="footer">
    <section>
        <h2 id="slack">Min side på slack</h2>
        <a href="https://nav-it.slack.com/archives/C9CJ794PP">#team-personbruker</a>
        <a href="https://nav-it.slack.com/archives/CR61BPH7G">#brukernotifikasjoner</a>
        <a href="https://nav-it.slack.com/archives/C04E3K5MMMY">#utkast</a>
    </section>
</div>
        </footer>
        <script src="../js/jquery-3.6.0.min.js"></script>
        <script src="../js/bootstrap.min.js"></script>
        <script>
            var base_url = "..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../js/base.js"></script>
        <script src="../scripts/override_navbar-background.js"></script>
        <script src="../search/main.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Søk</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Lukk</span></button>
            </div>
            <div class="modal-body">
                <p>Her kan du søke i disse dokumentene. Skriv søketeksten nedenfor.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Søk ..." id="mkdocs-search-query" title="Skriv søketeksten her">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="Fant ingen resultater"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Tastatursnarveier</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Lukk</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Taster</th>
                    <th>Handling</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Åpne denne hjelpen</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Neste side</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Forrige side</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Søk</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
