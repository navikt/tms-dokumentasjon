{"config":{"indexing":"full","lang":["en"],"min_search_length":3,"prebuild_index":false,"separator":"[\\s\\-]+"},"docs":[{"location":"","text":"Utvikler docs Her finner du teknisk informasjon om hvordan teamet ditt kan f\u00e5 inn innhold p\u00e5 min side. Ta gjerne en titt p\u00e5 innholdsguiden f\u00f8r du setter i gang! Og se dokumentasjon p\u00e5 Aksel for eksempler og mer om hvordan de forskjellige produktene skal brukes.","title":"Utvikler docs"},{"location":"#utvikler-docs","text":"Her finner du teknisk informasjon om hvordan teamet ditt kan f\u00e5 inn innhold p\u00e5 min side. Ta gjerne en titt p\u00e5 innholdsguiden f\u00f8r du setter i gang! Og se dokumentasjon p\u00e5 Aksel for eksempler og mer om hvordan de forskjellige produktene skal brukes.","title":"Utvikler docs"},{"location":"guide/","text":"Innholdsguide Usikker p\u00e5 hvilken type innholdet ditt er? Sjekk ut figma-veilederen v\u00e5r !","title":"Innholdsguide"},{"location":"guide/#innholdsguide","text":"Usikker p\u00e5 hvilken type innholdet ditt er? Sjekk ut figma-veilederen v\u00e5r !","title":"Innholdsguide"},{"location":"microfrontend/","text":"Microfrontends p\u00e5 min side Personalisering av Min side med microfrontends. Microfrontendene brukt p\u00e5 min side kommer i form av sm\u00e5 bokser med forskjellig funksjonalitet og innhold teamene \u00f8nsker \u00e5 presentere til en spesifikk gruppe brukere. Det overordnede konseptet er at bruker skal finne igjen mye av sitt mest relevante innhold og av innganger gruppert og l\u00f8ftet p\u00e5 min side. V\u00e5r microfrontendrigg best\u00e5r av tre deler. Mikrofrontenden som lastes opp til frontend-plattform sin CDN, min side som viser microfrontendene, og Kafka-backenden for \u00e5 aktivere og deaktivere mikrofrontends for spesifikke brukere. Selve mikrofrontenden blir bygget til ESM, lastet opp til CDN og hentes deretter inn som en remote ES-Modul. Sett opp microfrontend F\u00f8lg readme til denne templaten . Design Vi stiller visse designkrav til utformingen av microfrontendene, for \u00e5 ivareta en god helhetlig brukeropplevelse. Spr\u00e5k Alt innhold m\u00e5 v\u00e6re tilgjengelig p\u00e5 bokm\u00e5l, nynorsk og engelsk. Spr\u00e5kh\u00e5ndtering har vi allerede satt opp her . Dependencies Vi deler noen dependencies p\u00e5 tvers av apper. Per n\u00e5 er det react og react-dom. DS-css blir ogs\u00e5 delt og b\u00f8r ligge p\u00e5 samme major versjon. Veilendende versjon ligger her . Amplitude Amplitude fungerer som vanlig (se AAP sin mikrofrontend ). Dere kan fritt logge de eventene dere vil, men for at vi skal kunne foreta m\u00e5linger for Min side som helhet er det p\u00e5krevd at trykk p\u00e5 mikrofrontenden sender et navigere event med feltet komponent: <microfrontendId> . Videre anbefaler vi \u00e5 f\u00f8lge taksonominen i NAV. Toggle p\u00e5 microfrontend Koble p\u00e5 min-side-microfrontend-topicet (\"microfrontendId\" skal samsvare med navnet p\u00e5 frontendrepoet). Du kan n\u00e5 sende oss Enable/Disable meldinger via Kafka for \u00e5 skru av og p\u00e5 microfrontenden for spesifikke brukere Enable/disable Om en microfrontend vises avhenger av om den er enablet for en gitt bruker. Dette setter du ved \u00e5 sende en melding p\u00e5 microfrontend-topicet. Enable-melding Enable-melding sender du for \u00e5 vise microfrontenden til en bruker. { \"@action\": \"enable\", \"ident\": <ident for bruker: fnr/dnr>, \"microfrontend_id\": <microfrontendId>, \"sensitivitet\": <niv\u00e5 som kreves for \u00e5 se innholdet i mikrofrontenden, gyldige verdier: substantial og high>, \"@initiated_by\": <ditt-team> } Disable-melding Disable-melding sender du for \u00e5 slutte \u00e5 vise microfrontenden til en bruker. { \"@action\": \"disable\", \"ident\": <ident for bruker: fnr/dnr>, \"microfrontend_id\": <microfrontendId>, \"@initiated_by\":<ditt-team> } Meldingsbygger-bibliotek Det er tilgjengelig p\u00e5 github packages Hva er sensitivitet? Feltet sensitivitet i enablemeldingen korresponderer direkte til de nye acr-veridene i IDporten token. Om informasjonen som vises krever idporten-loa-high innlogging skal sensitivitet settes til high . Om informasjonen kan vises uavhengig av innloggingsniv\u00e5 skal sensitivitet settes til substantial . Om sensitivitet ikke er spesifisert i kafka-meldingen settes det alltid til high hos oss. Om en person logger inn med idporten-loa-substantial og det finnes mikrofrontender som personen kan se p\u00e5 idporten-loa-high vil bruker f\u00e5 beskjed om dette og link til en \"stepup\" login. Se ogs\u00e5 NAIS docs for mer info om acr-verdiene","title":"Microfrontend"},{"location":"microfrontend/#microfrontends-pa-min-side","text":"Personalisering av Min side med microfrontends. Microfrontendene brukt p\u00e5 min side kommer i form av sm\u00e5 bokser med forskjellig funksjonalitet og innhold teamene \u00f8nsker \u00e5 presentere til en spesifikk gruppe brukere. Det overordnede konseptet er at bruker skal finne igjen mye av sitt mest relevante innhold og av innganger gruppert og l\u00f8ftet p\u00e5 min side. V\u00e5r microfrontendrigg best\u00e5r av tre deler. Mikrofrontenden som lastes opp til frontend-plattform sin CDN, min side som viser microfrontendene, og Kafka-backenden for \u00e5 aktivere og deaktivere mikrofrontends for spesifikke brukere. Selve mikrofrontenden blir bygget til ESM, lastet opp til CDN og hentes deretter inn som en remote ES-Modul.","title":"Microfrontends p\u00e5 min side"},{"location":"microfrontend/#sett-opp-microfrontend","text":"F\u00f8lg readme til denne templaten .","title":"Sett opp microfrontend"},{"location":"microfrontend/#design","text":"Vi stiller visse designkrav til utformingen av microfrontendene, for \u00e5 ivareta en god helhetlig brukeropplevelse.","title":"Design"},{"location":"microfrontend/#sprak","text":"Alt innhold m\u00e5 v\u00e6re tilgjengelig p\u00e5 bokm\u00e5l, nynorsk og engelsk. Spr\u00e5kh\u00e5ndtering har vi allerede satt opp her .","title":"Spr\u00e5k"},{"location":"microfrontend/#dependencies","text":"Vi deler noen dependencies p\u00e5 tvers av apper. Per n\u00e5 er det react og react-dom. DS-css blir ogs\u00e5 delt og b\u00f8r ligge p\u00e5 samme major versjon. Veilendende versjon ligger her .","title":"Dependencies"},{"location":"microfrontend/#amplitude","text":"Amplitude fungerer som vanlig (se AAP sin mikrofrontend ). Dere kan fritt logge de eventene dere vil, men for at vi skal kunne foreta m\u00e5linger for Min side som helhet er det p\u00e5krevd at trykk p\u00e5 mikrofrontenden sender et navigere event med feltet komponent: <microfrontendId> . Videre anbefaler vi \u00e5 f\u00f8lge taksonominen i NAV.","title":"Amplitude"},{"location":"microfrontend/#toggle-pa-microfrontend","text":"Koble p\u00e5 min-side-microfrontend-topicet (\"microfrontendId\" skal samsvare med navnet p\u00e5 frontendrepoet). Du kan n\u00e5 sende oss Enable/Disable meldinger via Kafka for \u00e5 skru av og p\u00e5 microfrontenden for spesifikke brukere","title":"Toggle p\u00e5 microfrontend"},{"location":"microfrontend/#enabledisable","text":"Om en microfrontend vises avhenger av om den er enablet for en gitt bruker. Dette setter du ved \u00e5 sende en melding p\u00e5 microfrontend-topicet.","title":"Enable/disable"},{"location":"microfrontend/#enable-melding","text":"Enable-melding sender du for \u00e5 vise microfrontenden til en bruker. { \"@action\": \"enable\", \"ident\": <ident for bruker: fnr/dnr>, \"microfrontend_id\": <microfrontendId>, \"sensitivitet\": <niv\u00e5 som kreves for \u00e5 se innholdet i mikrofrontenden, gyldige verdier: substantial og high>, \"@initiated_by\": <ditt-team> }","title":"Enable-melding"},{"location":"microfrontend/#disable-melding","text":"Disable-melding sender du for \u00e5 slutte \u00e5 vise microfrontenden til en bruker. { \"@action\": \"disable\", \"ident\": <ident for bruker: fnr/dnr>, \"microfrontend_id\": <microfrontendId>, \"@initiated_by\":<ditt-team> }","title":"Disable-melding"},{"location":"microfrontend/#meldingsbygger-bibliotek","text":"Det er tilgjengelig p\u00e5 github packages","title":"Meldingsbygger-bibliotek"},{"location":"microfrontend/#hva-er-sensitivitet","text":"Feltet sensitivitet i enablemeldingen korresponderer direkte til de nye acr-veridene i IDporten token. Om informasjonen som vises krever idporten-loa-high innlogging skal sensitivitet settes til high . Om informasjonen kan vises uavhengig av innloggingsniv\u00e5 skal sensitivitet settes til substantial . Om sensitivitet ikke er spesifisert i kafka-meldingen settes det alltid til high hos oss. Om en person logger inn med idporten-loa-substantial og det finnes mikrofrontender som personen kan se p\u00e5 idporten-loa-high vil bruker f\u00e5 beskjed om dette og link til en \"stepup\" login. Se ogs\u00e5 NAIS docs for mer info om acr-verdiene","title":"Hva er sensitivitet?"},{"location":"utkast/","text":"Utkast p\u00e5 min side En enklere inngang til p\u00e5begynte s\u00f8knader og dokument-innsendinger. Utkast er en underside av min side (tilgjengelig p\u00e5 <navurl>/minside/utkast ) der bruker skal kunne finne s\u00f8knader og dokument-innsendinger hen har begynt \u00e5 fylle ut, men ikke sendt inn enda. Utkast er bruker-initiert Det kan v\u00e6re innsendinger eller s\u00f8knader som en person har startet p\u00e5, men ikke sendt inn. Et utkast er i \u00f8yeblikket ikke en del av en persons interaksjon med NAV , selv om det kan bli det. Eksempel: En p\u00e5begynt s\u00f8knad. Den kan sendes inn, eller en bruker kan velge \u00e5 ikke sende den inn. Hvordan fungerer det? Koble p\u00e5 min-side-utkast-iac-topicet og kj\u00f8r p\u00e5! utkast st\u00f8tter tre hendelser: created, updated, og deleted Send en created-melding n\u00e5r en bruker har lagret et utkast Send en updated-melding hvis url-en eller tittelen til utkastet har endret seg. Send en deleted melding n\u00e5r bruker enten har sendt inn, eller hvis utkastet har blitt slettet enten av bruker eller systemet. Kafka topic : aapen-utkast-v1 tilgang : min-side-utkast-iac-topic hendelser : created , updated , deleted meldingsformat create og update { \"@event_name\": \"<operasjon>\", \"utkastId\": \"<uuid>\", \"ident\": \"<fnr eller lignende>\", \"link\": \"<link til utkast>\", \"tittel\": \"<tittel p\u00e5 utkast>\", \"tittel_i18n\": { \"<spr\u00e5kkode>\": \"oversatt tittel\" }, \"metrics\": { \"skjemanavn\": \"<skjema navn>\", \"skjemakode\": \"<NAV skjemakode>\" } } obligatoriske felt : @event_name , utkastId , \"ident\" , \"tittel\" delete { \"@event_name\": \"deleted\", \"utkastId\": \"<uuid>\" } Det finnes ogs\u00e5 et message-builder bibliotek som lager meldingene for deg. NB! Det er kun ting som ikke er innsendt som skal ligge p\u00e5 utkast-siden. Observability Hendelser blir logget til kibana med customfelter for filtrering Alle utkast: x_contenttype:\"utkast\" Spesifikt utkast: x_minside_id :\"<utkastid>\" Amplitude m\u00e5linger Utkast-frontenden logger et skjema \u00e5pent -event med url som payload til amplitude n\u00e5r bruker klikker p\u00e5 ett utkast. Om teamet ditt \u00f8nsker \u00e5 f\u00e5 med feltene skjemakode og skjemanavn m\u00e5 metricsfeltet v\u00e6re tilstede og komplett i create-meldingen","title":"Utkast"},{"location":"utkast/#utkast-pa-min-side","text":"En enklere inngang til p\u00e5begynte s\u00f8knader og dokument-innsendinger. Utkast er en underside av min side (tilgjengelig p\u00e5 <navurl>/minside/utkast ) der bruker skal kunne finne s\u00f8knader og dokument-innsendinger hen har begynt \u00e5 fylle ut, men ikke sendt inn enda. Utkast er bruker-initiert Det kan v\u00e6re innsendinger eller s\u00f8knader som en person har startet p\u00e5, men ikke sendt inn. Et utkast er i \u00f8yeblikket ikke en del av en persons interaksjon med NAV , selv om det kan bli det. Eksempel: En p\u00e5begynt s\u00f8knad. Den kan sendes inn, eller en bruker kan velge \u00e5 ikke sende den inn.","title":"Utkast p\u00e5 min side"},{"location":"utkast/#hvordan-fungerer-det","text":"Koble p\u00e5 min-side-utkast-iac-topicet og kj\u00f8r p\u00e5! utkast st\u00f8tter tre hendelser: created, updated, og deleted Send en created-melding n\u00e5r en bruker har lagret et utkast Send en updated-melding hvis url-en eller tittelen til utkastet har endret seg. Send en deleted melding n\u00e5r bruker enten har sendt inn, eller hvis utkastet har blitt slettet enten av bruker eller systemet.","title":"Hvordan fungerer det?"},{"location":"utkast/#kafka","text":"topic : aapen-utkast-v1 tilgang : min-side-utkast-iac-topic hendelser : created , updated , deleted","title":"Kafka"},{"location":"utkast/#meldingsformat","text":"","title":"meldingsformat"},{"location":"utkast/#create-og-update","text":"{ \"@event_name\": \"<operasjon>\", \"utkastId\": \"<uuid>\", \"ident\": \"<fnr eller lignende>\", \"link\": \"<link til utkast>\", \"tittel\": \"<tittel p\u00e5 utkast>\", \"tittel_i18n\": { \"<spr\u00e5kkode>\": \"oversatt tittel\" }, \"metrics\": { \"skjemanavn\": \"<skjema navn>\", \"skjemakode\": \"<NAV skjemakode>\" } } obligatoriske felt : @event_name , utkastId , \"ident\" , \"tittel\"","title":"create og update"},{"location":"utkast/#delete","text":"{ \"@event_name\": \"deleted\", \"utkastId\": \"<uuid>\" } Det finnes ogs\u00e5 et message-builder bibliotek som lager meldingene for deg. NB! Det er kun ting som ikke er innsendt som skal ligge p\u00e5 utkast-siden.","title":"delete"},{"location":"utkast/#observability","text":"Hendelser blir logget til kibana med customfelter for filtrering Alle utkast: x_contenttype:\"utkast\" Spesifikt utkast: x_minside_id :\"<utkastid>\"","title":"Observability"},{"location":"utkast/#amplitude-malinger","text":"Utkast-frontenden logger et skjema \u00e5pent -event med url som payload til amplitude n\u00e5r bruker klikker p\u00e5 ett utkast. Om teamet ditt \u00f8nsker \u00e5 f\u00e5 med feltene skjemakode og skjemanavn m\u00e5 metricsfeltet v\u00e6re tilstede og komplett i create-meldingen","title":"Amplitude m\u00e5linger"},{"location":"varsler/","text":"Varsler p\u00e5 min side Varsler gj\u00f8r det mulig \u00e5 sende beskjeder og oppgaver til en bruker som vises i varselbjella og p\u00e5 varselsiden via kafka. Varslene skal inaktiveres hvis de ikke er relevante lengre. Inaktiverte varsler vil fortsatt v\u00e6re tilgjengelig p\u00e5 tidligere varsler siden . Produsere varsel-hendelser Konsumere varsel Migrere fra AVRO-topic","title":"Oversikt"},{"location":"varsler/#varsler-pa-min-side","text":"Varsler gj\u00f8r det mulig \u00e5 sende beskjeder og oppgaver til en bruker som vises i varselbjella og p\u00e5 varselsiden via kafka. Varslene skal inaktiveres hvis de ikke er relevante lengre. Inaktiverte varsler vil fortsatt v\u00e6re tilgjengelig p\u00e5 tidligere varsler siden . Produsere varsel-hendelser Konsumere varsel Migrere fra AVRO-topic","title":"Varsler p\u00e5 min side"},{"location":"varsler/konsumere/","text":"Lytte p\u00e5 aktiverte og inaktiverte varsler Topic: aapen-varsel-hendelse Tilgang: aapen-varsel-hendelse-iac Eksempler Oppgave med eventId \"123\" mottatt fra produsent \"team-alfabet:abc\" og lagret i database. { \"@event_name\": \"aktivert\", \"varselType\": \"oppgave\", \"eventId\": \"123\", \"namespace\": \"team-alfabet\", \"appnavn\": \"abc\" } Beskjed med eventId \"456\", opprettet av app \"team-alfabet:def\", fjernet av bruker. { \"@event_name\": \"inaktivert\", \"varselType\": \"beskjed\", \"eventId\": \"456\", \"namespace\": \"team-alfabet\", \"appnavn\": \"def\" }","title":"Konsumere varsler"},{"location":"varsler/konsumere/#lytte-pa-aktiverte-og-inaktiverte-varsler","text":"Topic: aapen-varsel-hendelse Tilgang: aapen-varsel-hendelse-iac","title":"Lytte p\u00e5 aktiverte og inaktiverte varsler"},{"location":"varsler/konsumere/#eksempler","text":"Oppgave med eventId \"123\" mottatt fra produsent \"team-alfabet:abc\" og lagret i database. { \"@event_name\": \"aktivert\", \"varselType\": \"oppgave\", \"eventId\": \"123\", \"namespace\": \"team-alfabet\", \"appnavn\": \"abc\" } Beskjed med eventId \"456\", opprettet av app \"team-alfabet:def\", fjernet av bruker. { \"@event_name\": \"inaktivert\", \"varselType\": \"beskjed\", \"eventId\": \"456\", \"namespace\": \"team-alfabet\", \"appnavn\": \"def\" }","title":"Eksempler"},{"location":"varsler/migrere/","text":"Migrere fra AVRO Topic Produsenter trenger kun \u00e5 forholde seg til ett topic for \u00e5 opprette og inaktivere varsler. Opprett pr i github-repository . Buildere og avro Vi bruker ikke lenger avro for \u00e5 validere schema. Varsel-eventer sendes som json-string, med varsel-id som n\u00f8kkel. Endringer i meldingene Se produsere varsler for dokumentasjon av nytt format. meldingstyper Tidligere har det v\u00e6rt fire meldingstyper (beskjed, oppgave, innboks, done). Disse er n\u00e5 sl\u00e5tt sammen til to objekter: opprett og inaktiver. Varseltypen spesifiseres i opprett-eventet. endring av feltnavn eventId -> varselId sikkerhetsnivaa -> sensitivitet (3 -> substantial, 4 -> high) synligFremTil -> aktivFremTil fodselsnummer -> ident deprekerte felter grupperingsId og tidspunkt er fjernet. tekst Alle tekster m\u00e5 ha en spr\u00e5kkode. Det er anbefalt \u00e5 legge til tekst for flere spr\u00e5k. Om det er tekst p\u00e5 flere spr\u00e5k, m\u00e5 \u00e9n v\u00e6re satt som default. Eksempel Et system sender varsler til brukere til gammelt topic med avro, og skal migreres. Varslene har: - type oppgave - sikkerhetsniv\u00e5 4 - lenke til https://www.nav.no - frist 14 dager etter oppretting - teksten \"Dette er et oppgave-varsel\" - ekstern varsling p\u00e5 sms med teksten \"Dette er en sms om oppgave\" Gammelt oppsett med avro-builder val gammeltOppgaveTopic = \"min-side.aapen-brukernotifikasjon-oppgave-v1\" val kafkaProps = Properties().apply { put(ProducerConfig.KEY_SERIALIZER_CLASS_CONFIG, KafkaAvroSerializer::class.java) put(ProducerConfig.VALUE_SERIALIZER_CLASS_CONFIG, KafkaAvroSerializer::class.java) // ... } val kafkaProducer = KafkaProducer<NokkelInput, OppgaveInput>(kafkaProps) val oppgaveId = UUID.randomUUID().toString() val nokkelInput = NokkelInputBuilder() .withEventId(oppgaveId) .withGrupperingsId(\"123\") .withFodselsnummer(fodselsnummer) .withNamespace(\"test-team\") .withAppnavn(\"demo-app\") .build() val oppgaveInput = OppgaveInputBuilder() .withTidspunkt(LocalDateTime.now()) .withSynligFremTil(LocalDateTime.now().plusDays(14)) .withTekst(\"Dette er et oppgave-varsel\") .withLink(URL(\"https://www.nav.no\")) .withSikkerhetsnivaa(4) .withEksternVarsling(true) .withSmsVarslingstekst(\"Dette er en sms om oppgave\") .withPrefererteKanaler(\"SMS\") kafkaProducer.send(ProducerRecord(gammeltOppgaveTopic, nokkelInput, oppgaveInput)) // ... val gammeltDoneTopic = \"min-side.aapen-brukernotifikasjon-done-v1\" val done = DoneInputBuilder() .withTidspunkt(now()) kafkaProducer.send(ProducerRecord(gammeltDoneTopic, nokkel, done)) Nytt oppsett med kotlin-builder val nyttVarselTopic = \"min-side.aapen-brukervarsel-v1\" val kafkaProps = Properties().apply { put(ProducerConfig.KEY_SERIALIZER_CLASS_CONFIG, StringSerializer::class.java) put(ProducerConfig.VALUE_SERIALIZER_CLASS_CONFIG, StringSerializer::class.java) // ... } val kafkaProducer = KafkaProducer<String, String>(kafkaProps) val oppgaveId = UUID.randomUUID().toString() val opprettVarsel = VarselActionBuilder.opprett { type = Varseltype.Oppgave varselId = oppgaveId sensitivitet = Sensitivitet.High ident = fodselsnummer tekst = Tekst( spraakkode = \"nb\", tekst = \"Dette er et oppgave-varsel\", default = true ) link = \"https://www.nav.no\" aktivFremTil = ZonedDateTime.now().plusDays(14) eksternVarsling = EksternVarslingBestilling( prefererteKanaler = listOf(EksternKanal.SMS), smsVarslingstekst = \"Dette er en sms om oppgave\", ) } kafkaProducer.send(ProducerRecord(nyttVarselTopic, varselId, opprettVarsel)) // ... val inaktiverVarsel = VarselActionBuilder.inaktiver { varselId = oppgaveId } kafkaProducer.send(ProducerRecord(nyttVarselTopic, varselId, inaktiverVarsel))","title":"Migrere fra AVRO"},{"location":"varsler/migrere/#migrere-fra-avro","text":"","title":"Migrere fra AVRO"},{"location":"varsler/migrere/#topic","text":"Produsenter trenger kun \u00e5 forholde seg til ett topic for \u00e5 opprette og inaktivere varsler. Opprett pr i github-repository .","title":"Topic"},{"location":"varsler/migrere/#buildere-og-avro","text":"Vi bruker ikke lenger avro for \u00e5 validere schema. Varsel-eventer sendes som json-string, med varsel-id som n\u00f8kkel.","title":"Buildere og avro"},{"location":"varsler/migrere/#endringer-i-meldingene","text":"Se produsere varsler for dokumentasjon av nytt format.","title":"Endringer i meldingene"},{"location":"varsler/migrere/#meldingstyper","text":"Tidligere har det v\u00e6rt fire meldingstyper (beskjed, oppgave, innboks, done). Disse er n\u00e5 sl\u00e5tt sammen til to objekter: opprett og inaktiver. Varseltypen spesifiseres i opprett-eventet.","title":"meldingstyper"},{"location":"varsler/migrere/#endring-av-feltnavn","text":"eventId -> varselId sikkerhetsnivaa -> sensitivitet (3 -> substantial, 4 -> high) synligFremTil -> aktivFremTil fodselsnummer -> ident","title":"endring av feltnavn"},{"location":"varsler/migrere/#deprekerte-felter","text":"grupperingsId og tidspunkt er fjernet.","title":"deprekerte felter"},{"location":"varsler/migrere/#tekst","text":"Alle tekster m\u00e5 ha en spr\u00e5kkode. Det er anbefalt \u00e5 legge til tekst for flere spr\u00e5k. Om det er tekst p\u00e5 flere spr\u00e5k, m\u00e5 \u00e9n v\u00e6re satt som default.","title":"tekst"},{"location":"varsler/migrere/#eksempel","text":"Et system sender varsler til brukere til gammelt topic med avro, og skal migreres. Varslene har: - type oppgave - sikkerhetsniv\u00e5 4 - lenke til https://www.nav.no - frist 14 dager etter oppretting - teksten \"Dette er et oppgave-varsel\" - ekstern varsling p\u00e5 sms med teksten \"Dette er en sms om oppgave\"","title":"Eksempel"},{"location":"varsler/migrere/#gammelt-oppsett-med-avro-builder","text":"val gammeltOppgaveTopic = \"min-side.aapen-brukernotifikasjon-oppgave-v1\" val kafkaProps = Properties().apply { put(ProducerConfig.KEY_SERIALIZER_CLASS_CONFIG, KafkaAvroSerializer::class.java) put(ProducerConfig.VALUE_SERIALIZER_CLASS_CONFIG, KafkaAvroSerializer::class.java) // ... } val kafkaProducer = KafkaProducer<NokkelInput, OppgaveInput>(kafkaProps) val oppgaveId = UUID.randomUUID().toString() val nokkelInput = NokkelInputBuilder() .withEventId(oppgaveId) .withGrupperingsId(\"123\") .withFodselsnummer(fodselsnummer) .withNamespace(\"test-team\") .withAppnavn(\"demo-app\") .build() val oppgaveInput = OppgaveInputBuilder() .withTidspunkt(LocalDateTime.now()) .withSynligFremTil(LocalDateTime.now().plusDays(14)) .withTekst(\"Dette er et oppgave-varsel\") .withLink(URL(\"https://www.nav.no\")) .withSikkerhetsnivaa(4) .withEksternVarsling(true) .withSmsVarslingstekst(\"Dette er en sms om oppgave\") .withPrefererteKanaler(\"SMS\") kafkaProducer.send(ProducerRecord(gammeltOppgaveTopic, nokkelInput, oppgaveInput)) // ... val gammeltDoneTopic = \"min-side.aapen-brukernotifikasjon-done-v1\" val done = DoneInputBuilder() .withTidspunkt(now()) kafkaProducer.send(ProducerRecord(gammeltDoneTopic, nokkel, done))","title":"Gammelt oppsett med avro-builder"},{"location":"varsler/migrere/#nytt-oppsett-med-kotlin-builder","text":"val nyttVarselTopic = \"min-side.aapen-brukervarsel-v1\" val kafkaProps = Properties().apply { put(ProducerConfig.KEY_SERIALIZER_CLASS_CONFIG, StringSerializer::class.java) put(ProducerConfig.VALUE_SERIALIZER_CLASS_CONFIG, StringSerializer::class.java) // ... } val kafkaProducer = KafkaProducer<String, String>(kafkaProps) val oppgaveId = UUID.randomUUID().toString() val opprettVarsel = VarselActionBuilder.opprett { type = Varseltype.Oppgave varselId = oppgaveId sensitivitet = Sensitivitet.High ident = fodselsnummer tekst = Tekst( spraakkode = \"nb\", tekst = \"Dette er et oppgave-varsel\", default = true ) link = \"https://www.nav.no\" aktivFremTil = ZonedDateTime.now().plusDays(14) eksternVarsling = EksternVarslingBestilling( prefererteKanaler = listOf(EksternKanal.SMS), smsVarslingstekst = \"Dette er en sms om oppgave\", ) } kafkaProducer.send(ProducerRecord(nyttVarselTopic, varselId, opprettVarsel)) // ... val inaktiverVarsel = VarselActionBuilder.inaktiver { varselId = oppgaveId } kafkaProducer.send(ProducerRecord(nyttVarselTopic, varselId, inaktiverVarsel))","title":"Nytt oppsett med kotlin-builder"},{"location":"varsler/produsere/","text":"Komme i gang med varsler For brukeropplevelsen er det viktig at du bruker riktig type varsel. Ta gjerne en ekstrasjekk med innholdsguiden v\u00e5r . Kafka tilgang: Opprett en pull-request mot topic aapen-brukervarsel-v1 i min-side-brukervarsel-topic-iac . Koble p\u00e5 topicene. Send event! Varseltyper type beskrivelse Deaktiveres av Beskjed For korte p\u00e5minnelser eller oppdatering av status Bruker, produsent, eller min side hvis aktivFremTil dato er satt og dato er passert. Oppgave For noe som m\u00e5 bli utf\u00f8rt Produsent n\u00e5r oppgaven er utf\u00f8rt ( inaktiver-event), eller av min side hvis aktivFremTil dato er satt eller varslet har v\u00e6rt aktivt i mer enn ett \u00e5r. Innboks For varsler om digitale innbokser andre steder i NAV Produsent NB! Det er viktig \u00e5 huske \u00e5 sende inaktiver-event for oppgave-varsler. Hvis ikke vil det se ut for personen som at oppgaven ikke er utf\u00f8rt. Alle varsler slettes 1 \u00e5r etter mottaksdato. Ekstern varsling Produsent kan velge om bruker ogs\u00e5 skal varsles via eksterne kanaler (sms og epost). Produsent kan velge preferert kanal, og hvorvidt standardtekst skal overskrives. Standardtekst er av typen: Hei! Du har f\u00e5tt en ny <varseltype> fra NAV. Logg inn p\u00e5 NAV for \u00e5 se hva varselet gjelder. Vennlig hilsen NAV Eksterne varseltekster skal ikke inneholde lenker. Det er ogs\u00e5 produsentens ansvar \u00e5 ikke sende sensitiv informasjon p\u00e5 epost og sms. Revarsling Varsler med typen oppgave eller innboks f\u00e5r automatisk revarsling dersom varselet ikke er ferdigstilt etter et bestemt antall dager. Oppgaver blir revarsler etter 7 dager, og innboks blir revarslet etter 4 dager. Overskriving av standardtekster Dersom en velger \u00e5 overskrive standardtekster for epost/sms, er det anbefalt \u00e5 overskrive samtlige tekster. Dette er fordi bruker kan motta varsler via annen kanal enn preferansen. Kafka, schemas og buildere Min side varsler bruker ikke lenger Avro for schema-validering og serialisering. Produsenter sender eventer direkte p\u00e5 json-format. Vi tilbyr to sett med buildere for henholdsvis java- og kotlin-prosjekter. Det er ikke strengt n\u00f8dvendig \u00e5 bruke disse, men sterkt anbefalt. Builderne s\u00f8rger for at format er riktig og gj\u00f8r forh\u00e5ndsvalidering av innhold. Det er ogs\u00e5 anbefalt \u00e5 bruke varselId som kafka-n\u00f8kkel, for \u00e5 opprettholde kronologi per enkelt varsel. Builderne finnes i f\u00f8lgende bibliotek: Github Maven repository kotlin: no.nav.tms.varsel:kotlin-builder:1.0.0 java: no.nav.tms.varsel:java-builder:1.0.0 Husk \u00e5 legge til autentisert repository https://maven.pkg.github.com/navikt/tms-varsel-authority Oppretting av varsel For \u00e5 gi varsel til bruker sender en et opprett-varsel event. Opprett-varsel felter felt p\u00e5krevd beskrivelse restriksjoner tillegginfo type ja Type p\u00e5 varsel (beskjed, oppgave, innboks) M\u00e5 v\u00e6re \u00e9n av beskjed , oppgave , innboks varselId ja Id til varselet. Produsenten bruker samme Id til \u00e5 inaktivere varsel M\u00e5 v\u00e6re UUID eller ULID ident ja Fodselsnummer (evt. d-nummer eller tilsvarende) til mottaker av varsel M\u00e5 ha 11 siffer tekster ja, minst 1 Teksten som faktisk vises i varselet med spr\u00e5kkode. Dersom flere tekster p\u00e5 ulike spr\u00e5k er gitt m\u00e5 \u00e9n tekst v\u00e6re satt som default Spr\u00e5kkode m\u00e5 f\u00f8lge ISO-639 (typen no , nb , en ...) link ikke for beskjed Lenke som blir aktivert n\u00e5r en person trykker p\u00e5 varselet i varselbjella eller p\u00e5 min side Komplett URL, inkludert https protokoll. sensitivitet ja p\u00e5krevd level-of-assurance for \u00e5 kunne se innhold i varsel \u00c9n av high , substantial high og substantial tilsvarer det som tidligere var henholdvis niv\u00e5 4 og 3 . Hvis personen har varsler med sensitivitet high , men er logget inn med LoA substantial , vil hen se type varsel, men ikke innholdet. aktivFremTil nei Tidspunkt for n\u00e5r varslet skal inaktiverer automatisk av systemet Tidspunkt med tidssone. UTC eller Z er anbefalt St\u00f8ttes ikke for Innboks-varsler eksternVarsling nei Om det skal sendes sms og/eller epost til mottaker Kan kun velge preferert kanal SMS eller EPOST . Dersom ekstern varslingstekst ikke er satt blir det sendt en standardtekst. produsent ja Teknisk kilde til varsel-eventet Ingen spesielle Buildere vil fors\u00f8ke \u00e5 hente dette automatisk basert p\u00e5 nais-milj\u00f8variabler. Der disse ikke er tilgjengelige m\u00e5 produsent settes manuelt. Json-format { \"@event_name\": \"opprett\", \"type\": \"<type>\", \"varselId\": \"<varselId>\", \"ident\": \"<ident>\", \"tekster\": [ { \"spraakkode\": \"<spraakkode>\", \"tekst\": \"<tekst>\", \"default\": true } ], \"link\": \"<link>\", \"sensitivitet\": \"<sensitivitet>\", \"aktivFremTil\": \"<aktivFremTil>\", \"eksternVarsling\": { \"prefererteKanaler\": [\"SMS\", \"EPOST\"], \"smsVarslingstekst\": \"<smsTekst>\", \"epostVarslingstittel\": \"epostTittel\", \"epostVarslingstekst\": \"epostTekst\" }, \"produsent\": { \"cluster\": \"<cluster>\", \"namespace\": \"<namespace>\", \"appnavn\": \"<appnavn>\" } } Eksempel med buildere Eksempel p\u00e5 oppretting av Oppgave-varsel for bruker 12345678901 med id aabbccdd-abcd-1234-5678-abcdef123456 . Varselet skal: - ha sensitivitet high - lenke til https://www.nav.no - l\u00f8pe ut 14 dager etter oppretting - ha en norsk (default) og en engelsk tekst - varsles p\u00e5 sms med standardtekst. Med kotlin-builder val kafkaValueJson = VarselActionBuilder.opprett { type = Varseltype.Oppgave varselId = \"aabbccdd-abcd-1234-5678-abcdef123456\" sensitivitet = Sensitivitet.High ident = \"12345678901\" tekster += Tekst( spraakkode = \"nb\", tekst = \"Norsk tekst\", default = true ) tekster += Tekst( spraakkode = \"en\", tekst = \"English text\", default = false ) link = \"https://www.nav.no\" aktivFremTil = ZonedDateTime.now(ZoneId.of(\"Z\")).plusDays(14) eksternVarsling = EksternVarslingBestilling(prefererteKanaler = listOf(EksternKanal.SMS)) } Med java-builder String kafkaValueJson = OpprettVarselBuilder.newInstance() .withType(Varseltype.Oppgave) .withVarselId(\"aabbccdd-abcd-1234-5678-abcdef123456\") .withSensitivitet(Sensitivitet.High) .withIdent(\"12345678901\") .withTekst(\"nb\", \"Norsk tekst\", true) .withTekst(\"en\", \"English text\", false) .withLink(\"https://www.nav.no\") .withAktivFremTil(ZonedDateTime.now(ZoneId.of(\"Z\")).plusDays(14)) .withEksternVarsling(EksternKanal.SMS) .build(); Inaktivering av varsel Oppgave- og innboks-varsler inaktiveres av produsent. Dette gj\u00f8r en ved \u00e5 sende et inaktiver-event. Inaktiver-varsel felter felt p\u00e5krevd beskrivelse tillegginfo varselId ja Id til varselet som skal inaktiveres produsent ja Teknisk kilde til varsel-eventet Buildere vil fors\u00f8ke \u00e5 hente dette automatisk basert p\u00e5 nais-milj\u00f8variabler. Der disse ikke er tilgjengelige m\u00e5 produsent settes manuelt. Json-format { \"@event_name\": \"inaktiver\", \"varselId\": \"<varselId>\", \"produsent\": { \"cluster\": \"<cluster>\", \"namespace\": \"<namespace>\", \"appnavn\": \"<appnavn>\" } } Eksempel med buildere Eksempel p\u00e5 inaktivering av varsel med id aabbccdd-abcd-1234-5678-abcdef123456 . Med kotlin-builder val kafkaValueJson = VarselActionBuilder.inaktiver { varselId = \"aabbccdd-abcd-1234-5678-abcdef123456\" } Med java-builder String kafkaValueJson = InaktiverVarselBuilder.newInstance() .withVarselId(\"aabbccdd-abcd-1234-5678-abcdef123456\") .build(); Overv\u00e5king av varsler Logging Hendelser blir logget til kibana med custom felter for filtrering Alle varsler: x_contenttype:\"varsel\" Sendt fra bestemt team: x_initiated_by: \"<namespace>\" Spesifikt varsel: x_minside_id :\"<varselId>\" Kafka Produsenter kan lytte p\u00e5 topic aapen-varsel-hendelse-v1 for \u00e5 f\u00f8lge med p\u00e5 status p\u00e5 varsler. Hendelser som kan skje for varsler er opprettet , inaktivert , slettet og eksternStatusOppdatert . Opprettet, inaktivert, og slettet Beskriver intern endring i status for et varsel. opprettet : Opprett-varsel event er validert og varsel er opprettet i database. inaktivert : Varsel er inaktivert av f. eks. produsent eller bruker selv. slettet : Varsel er slettet og ikke lenger synlig for bruker eller saksbehandler. Eksempel for oppgave-varsel f\u00f8rst opprettet av team-test:demo-app med id 11223344-aaaa-bbbb-cccc-112233445566 . { \"@event_name\": \"<opprettet|inaktivert|slettet>\", \"varseltype\": \"oppgave\", \"varselId\": \"11223344-aaaa-bbbb-cccc-112233445566\", \"namespace\": \"team-test\", \"appnavn\": \"demo-app\" } Ekstern status oppdatert Beskriver ekstern endring i status for et varsel (sms og epost). Kommer med ulike 3 statuser. bestilt : Bestilling av varsling p\u00e5 sms/epost er mottatt av distribusjonsystem. sendt : Ekstern varsling er bekreftet sendt via bestemt kanal (sms eller epost), og om det er renotifikasjon. feilet : Ekstern varsling feilet. Kommer med feilmelding. Eksempler: { \"@event_name\": \"eksternStatusOppdatert\", \"status\": \"bestilt\", \"varseltype\": \"oppgave\", \"varselId\": \"11223344-aaaa-bbbb-cccc-112233445566\", \"namespace\": \"team-test\", \"appnavn\": \"demo-app\" } { \"@event_name\": \"eksternStatusOppdatert\", \"status\": \"sendt\", \"varseltype\": \"oppgave\", \"varselId\": \"11223344-aaaa-bbbb-cccc-112233445566\", \"kanal\": \"SMS\", \"renotifikasjon\": false, \"namespace\": \"team-test\", \"appnavn\": \"demo-app\" } { \"@event_name\": \"eksternStatusOppdatert\", \"status\": \"feilet\", \"varseltype\": \"oppgave\", \"varselId\": \"11223344-aaaa-bbbb-cccc-112233445566\", \"feilmelding\": \"mottaker har reservert seg mot digital kommunikasjon\", \"namespace\": \"team-test\", \"appnavn\": \"demo-app\" }","title":"Produsere varsler"},{"location":"varsler/produsere/#komme-i-gang-med-varsler","text":"For brukeropplevelsen er det viktig at du bruker riktig type varsel. Ta gjerne en ekstrasjekk med innholdsguiden v\u00e5r . Kafka tilgang: Opprett en pull-request mot topic aapen-brukervarsel-v1 i min-side-brukervarsel-topic-iac . Koble p\u00e5 topicene. Send event!","title":"Komme i gang med varsler"},{"location":"varsler/produsere/#varseltyper","text":"type beskrivelse Deaktiveres av Beskjed For korte p\u00e5minnelser eller oppdatering av status Bruker, produsent, eller min side hvis aktivFremTil dato er satt og dato er passert. Oppgave For noe som m\u00e5 bli utf\u00f8rt Produsent n\u00e5r oppgaven er utf\u00f8rt ( inaktiver-event), eller av min side hvis aktivFremTil dato er satt eller varslet har v\u00e6rt aktivt i mer enn ett \u00e5r. Innboks For varsler om digitale innbokser andre steder i NAV Produsent NB! Det er viktig \u00e5 huske \u00e5 sende inaktiver-event for oppgave-varsler. Hvis ikke vil det se ut for personen som at oppgaven ikke er utf\u00f8rt. Alle varsler slettes 1 \u00e5r etter mottaksdato.","title":"Varseltyper"},{"location":"varsler/produsere/#ekstern-varsling","text":"Produsent kan velge om bruker ogs\u00e5 skal varsles via eksterne kanaler (sms og epost). Produsent kan velge preferert kanal, og hvorvidt standardtekst skal overskrives. Standardtekst er av typen: Hei! Du har f\u00e5tt en ny <varseltype> fra NAV. Logg inn p\u00e5 NAV for \u00e5 se hva varselet gjelder. Vennlig hilsen NAV Eksterne varseltekster skal ikke inneholde lenker. Det er ogs\u00e5 produsentens ansvar \u00e5 ikke sende sensitiv informasjon p\u00e5 epost og sms.","title":"Ekstern varsling"},{"location":"varsler/produsere/#revarsling","text":"Varsler med typen oppgave eller innboks f\u00e5r automatisk revarsling dersom varselet ikke er ferdigstilt etter et bestemt antall dager. Oppgaver blir revarsler etter 7 dager, og innboks blir revarslet etter 4 dager.","title":"Revarsling"},{"location":"varsler/produsere/#overskriving-av-standardtekster","text":"Dersom en velger \u00e5 overskrive standardtekster for epost/sms, er det anbefalt \u00e5 overskrive samtlige tekster. Dette er fordi bruker kan motta varsler via annen kanal enn preferansen.","title":"Overskriving av standardtekster"},{"location":"varsler/produsere/#kafka-schemas-og-buildere","text":"Min side varsler bruker ikke lenger Avro for schema-validering og serialisering. Produsenter sender eventer direkte p\u00e5 json-format. Vi tilbyr to sett med buildere for henholdsvis java- og kotlin-prosjekter. Det er ikke strengt n\u00f8dvendig \u00e5 bruke disse, men sterkt anbefalt. Builderne s\u00f8rger for at format er riktig og gj\u00f8r forh\u00e5ndsvalidering av innhold. Det er ogs\u00e5 anbefalt \u00e5 bruke varselId som kafka-n\u00f8kkel, for \u00e5 opprettholde kronologi per enkelt varsel. Builderne finnes i f\u00f8lgende bibliotek:","title":"Kafka, schemas og buildere"},{"location":"varsler/produsere/#github-maven-repository","text":"kotlin: no.nav.tms.varsel:kotlin-builder:1.0.0 java: no.nav.tms.varsel:java-builder:1.0.0 Husk \u00e5 legge til autentisert repository https://maven.pkg.github.com/navikt/tms-varsel-authority","title":"Github Maven repository"},{"location":"varsler/produsere/#oppretting-av-varsel","text":"For \u00e5 gi varsel til bruker sender en et opprett-varsel event.","title":"Oppretting av varsel"},{"location":"varsler/produsere/#opprett-varsel-felter","text":"felt p\u00e5krevd beskrivelse restriksjoner tillegginfo type ja Type p\u00e5 varsel (beskjed, oppgave, innboks) M\u00e5 v\u00e6re \u00e9n av beskjed , oppgave , innboks varselId ja Id til varselet. Produsenten bruker samme Id til \u00e5 inaktivere varsel M\u00e5 v\u00e6re UUID eller ULID ident ja Fodselsnummer (evt. d-nummer eller tilsvarende) til mottaker av varsel M\u00e5 ha 11 siffer tekster ja, minst 1 Teksten som faktisk vises i varselet med spr\u00e5kkode. Dersom flere tekster p\u00e5 ulike spr\u00e5k er gitt m\u00e5 \u00e9n tekst v\u00e6re satt som default Spr\u00e5kkode m\u00e5 f\u00f8lge ISO-639 (typen no , nb , en ...) link ikke for beskjed Lenke som blir aktivert n\u00e5r en person trykker p\u00e5 varselet i varselbjella eller p\u00e5 min side Komplett URL, inkludert https protokoll. sensitivitet ja p\u00e5krevd level-of-assurance for \u00e5 kunne se innhold i varsel \u00c9n av high , substantial high og substantial tilsvarer det som tidligere var henholdvis niv\u00e5 4 og 3 . Hvis personen har varsler med sensitivitet high , men er logget inn med LoA substantial , vil hen se type varsel, men ikke innholdet. aktivFremTil nei Tidspunkt for n\u00e5r varslet skal inaktiverer automatisk av systemet Tidspunkt med tidssone. UTC eller Z er anbefalt St\u00f8ttes ikke for Innboks-varsler eksternVarsling nei Om det skal sendes sms og/eller epost til mottaker Kan kun velge preferert kanal SMS eller EPOST . Dersom ekstern varslingstekst ikke er satt blir det sendt en standardtekst. produsent ja Teknisk kilde til varsel-eventet Ingen spesielle Buildere vil fors\u00f8ke \u00e5 hente dette automatisk basert p\u00e5 nais-milj\u00f8variabler. Der disse ikke er tilgjengelige m\u00e5 produsent settes manuelt.","title":"Opprett-varsel felter"},{"location":"varsler/produsere/#json-format","text":"{ \"@event_name\": \"opprett\", \"type\": \"<type>\", \"varselId\": \"<varselId>\", \"ident\": \"<ident>\", \"tekster\": [ { \"spraakkode\": \"<spraakkode>\", \"tekst\": \"<tekst>\", \"default\": true } ], \"link\": \"<link>\", \"sensitivitet\": \"<sensitivitet>\", \"aktivFremTil\": \"<aktivFremTil>\", \"eksternVarsling\": { \"prefererteKanaler\": [\"SMS\", \"EPOST\"], \"smsVarslingstekst\": \"<smsTekst>\", \"epostVarslingstittel\": \"epostTittel\", \"epostVarslingstekst\": \"epostTekst\" }, \"produsent\": { \"cluster\": \"<cluster>\", \"namespace\": \"<namespace>\", \"appnavn\": \"<appnavn>\" } }","title":"Json-format"},{"location":"varsler/produsere/#eksempel-med-buildere","text":"Eksempel p\u00e5 oppretting av Oppgave-varsel for bruker 12345678901 med id aabbccdd-abcd-1234-5678-abcdef123456 . Varselet skal: - ha sensitivitet high - lenke til https://www.nav.no - l\u00f8pe ut 14 dager etter oppretting - ha en norsk (default) og en engelsk tekst - varsles p\u00e5 sms med standardtekst.","title":"Eksempel med buildere"},{"location":"varsler/produsere/#med-kotlin-builder","text":"val kafkaValueJson = VarselActionBuilder.opprett { type = Varseltype.Oppgave varselId = \"aabbccdd-abcd-1234-5678-abcdef123456\" sensitivitet = Sensitivitet.High ident = \"12345678901\" tekster += Tekst( spraakkode = \"nb\", tekst = \"Norsk tekst\", default = true ) tekster += Tekst( spraakkode = \"en\", tekst = \"English text\", default = false ) link = \"https://www.nav.no\" aktivFremTil = ZonedDateTime.now(ZoneId.of(\"Z\")).plusDays(14) eksternVarsling = EksternVarslingBestilling(prefererteKanaler = listOf(EksternKanal.SMS)) }","title":"Med kotlin-builder"},{"location":"varsler/produsere/#med-java-builder","text":"String kafkaValueJson = OpprettVarselBuilder.newInstance() .withType(Varseltype.Oppgave) .withVarselId(\"aabbccdd-abcd-1234-5678-abcdef123456\") .withSensitivitet(Sensitivitet.High) .withIdent(\"12345678901\") .withTekst(\"nb\", \"Norsk tekst\", true) .withTekst(\"en\", \"English text\", false) .withLink(\"https://www.nav.no\") .withAktivFremTil(ZonedDateTime.now(ZoneId.of(\"Z\")).plusDays(14)) .withEksternVarsling(EksternKanal.SMS) .build();","title":"Med java-builder"},{"location":"varsler/produsere/#inaktivering-av-varsel","text":"Oppgave- og innboks-varsler inaktiveres av produsent. Dette gj\u00f8r en ved \u00e5 sende et inaktiver-event.","title":"Inaktivering av varsel"},{"location":"varsler/produsere/#inaktiver-varsel-felter","text":"felt p\u00e5krevd beskrivelse tillegginfo varselId ja Id til varselet som skal inaktiveres produsent ja Teknisk kilde til varsel-eventet Buildere vil fors\u00f8ke \u00e5 hente dette automatisk basert p\u00e5 nais-milj\u00f8variabler. Der disse ikke er tilgjengelige m\u00e5 produsent settes manuelt.","title":"Inaktiver-varsel felter"},{"location":"varsler/produsere/#json-format_1","text":"{ \"@event_name\": \"inaktiver\", \"varselId\": \"<varselId>\", \"produsent\": { \"cluster\": \"<cluster>\", \"namespace\": \"<namespace>\", \"appnavn\": \"<appnavn>\" } }","title":"Json-format"},{"location":"varsler/produsere/#eksempel-med-buildere_1","text":"Eksempel p\u00e5 inaktivering av varsel med id aabbccdd-abcd-1234-5678-abcdef123456 .","title":"Eksempel med buildere"},{"location":"varsler/produsere/#med-kotlin-builder_1","text":"val kafkaValueJson = VarselActionBuilder.inaktiver { varselId = \"aabbccdd-abcd-1234-5678-abcdef123456\" }","title":"Med kotlin-builder"},{"location":"varsler/produsere/#med-java-builder_1","text":"String kafkaValueJson = InaktiverVarselBuilder.newInstance() .withVarselId(\"aabbccdd-abcd-1234-5678-abcdef123456\") .build();","title":"Med java-builder"},{"location":"varsler/produsere/#overvaking-av-varsler","text":"","title":"Overv\u00e5king av varsler"},{"location":"varsler/produsere/#logging","text":"Hendelser blir logget til kibana med custom felter for filtrering Alle varsler: x_contenttype:\"varsel\" Sendt fra bestemt team: x_initiated_by: \"<namespace>\" Spesifikt varsel: x_minside_id :\"<varselId>\"","title":"Logging"},{"location":"varsler/produsere/#kafka","text":"Produsenter kan lytte p\u00e5 topic aapen-varsel-hendelse-v1 for \u00e5 f\u00f8lge med p\u00e5 status p\u00e5 varsler. Hendelser som kan skje for varsler er opprettet , inaktivert , slettet og eksternStatusOppdatert .","title":"Kafka"},{"location":"varsler/produsere/#opprettet-inaktivert-og-slettet","text":"Beskriver intern endring i status for et varsel. opprettet : Opprett-varsel event er validert og varsel er opprettet i database. inaktivert : Varsel er inaktivert av f. eks. produsent eller bruker selv. slettet : Varsel er slettet og ikke lenger synlig for bruker eller saksbehandler. Eksempel for oppgave-varsel f\u00f8rst opprettet av team-test:demo-app med id 11223344-aaaa-bbbb-cccc-112233445566 . { \"@event_name\": \"<opprettet|inaktivert|slettet>\", \"varseltype\": \"oppgave\", \"varselId\": \"11223344-aaaa-bbbb-cccc-112233445566\", \"namespace\": \"team-test\", \"appnavn\": \"demo-app\" }","title":"Opprettet, inaktivert, og slettet"},{"location":"varsler/produsere/#ekstern-status-oppdatert","text":"Beskriver ekstern endring i status for et varsel (sms og epost). Kommer med ulike 3 statuser. bestilt : Bestilling av varsling p\u00e5 sms/epost er mottatt av distribusjonsystem. sendt : Ekstern varsling er bekreftet sendt via bestemt kanal (sms eller epost), og om det er renotifikasjon. feilet : Ekstern varsling feilet. Kommer med feilmelding. Eksempler: { \"@event_name\": \"eksternStatusOppdatert\", \"status\": \"bestilt\", \"varseltype\": \"oppgave\", \"varselId\": \"11223344-aaaa-bbbb-cccc-112233445566\", \"namespace\": \"team-test\", \"appnavn\": \"demo-app\" } { \"@event_name\": \"eksternStatusOppdatert\", \"status\": \"sendt\", \"varseltype\": \"oppgave\", \"varselId\": \"11223344-aaaa-bbbb-cccc-112233445566\", \"kanal\": \"SMS\", \"renotifikasjon\": false, \"namespace\": \"team-test\", \"appnavn\": \"demo-app\" } { \"@event_name\": \"eksternStatusOppdatert\", \"status\": \"feilet\", \"varseltype\": \"oppgave\", \"varselId\": \"11223344-aaaa-bbbb-cccc-112233445566\", \"feilmelding\": \"mottaker har reservert seg mot digital kommunikasjon\", \"namespace\": \"team-test\", \"appnavn\": \"demo-app\" }","title":"Ekstern status oppdatert"}]}